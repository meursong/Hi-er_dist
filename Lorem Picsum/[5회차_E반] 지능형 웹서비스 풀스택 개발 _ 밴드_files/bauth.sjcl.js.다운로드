"use strict";var bauth={sjcl:{}};bauth.sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t},notReady:function(t){this.toString=function(){return"NOT READY: "+this.message},this.message=t}}},bauth.sjcl.codec.utf8String={fromBits:function(t){var e,i,r="",s=bauth.sjcl.bitArray.bitLength(t);for(e=0;e<s/8;e++)0==(3&e)&&(i=t[e/4]),r+=String.fromCharCode(i>>>24),i<<=8;return decodeURIComponent(escape(r))},toBits:function(t){t=unescape(encodeURIComponent(t));var e,i=[],r=0;for(e=0;e<t.length;e++)r=r<<8|t.charCodeAt(e),3==(3&e)&&(i.push(r),r=0);return 3&e&&i.push(bauth.sjcl.bitArray.partial(8*(3&e),r)),i}},bauth.sjcl.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(t,e,i){var r,s="",a=0,h=bauth.sjcl.codec.base64._chars,n=0,c=bauth.sjcl.bitArray.bitLength(t);for(i&&(h=h.substr(0,62)+"-_"),r=0;6*s.length<c;)s+=h.charAt((n^t[r]>>>a)>>>26),a<6?(n=t[r]<<6-a,a+=26,r++):(n<<=6,a-=6);for(;3&s.length&&!e;)s+="=";return s},toBits:function(t,e){t=t.replace(/\s|=/g,"");var i,r,s=[],a=0,h=bauth.sjcl.codec.base64._chars,n=0;for(e&&(h=h.substr(0,62)+"-_"),i=0;i<t.length;i++){if((r=h.indexOf(t.charAt(i)))<0)throw new bauth.sjcl.exception.invalid("this isn't base64!");a>26?(a-=26,s.push(n^r>>>a),n=r<<32-a):n^=r<<32-(a+=6)}return 56&a&&s.push(bauth.sjcl.bitArray.partial(56&a,n,1)),s}},bauth.sjcl.codec.base64url={fromBits:function(t){return bauth.sjcl.codec.base64.fromBits(t,1,1)},toBits:function(t){return bauth.sjcl.codec.base64.toBits(t,1)}},bauth.sjcl.bitArray={bitSlice:function(t,e,i){return t=bauth.sjcl.bitArray._shiftRight(t.slice(e/32),32-(31&e)).slice(1),void 0===i?t:bauth.sjcl.bitArray.clamp(t,i-e)},extract:function(t,e,i){var r=Math.floor(-e-i&31);return(-32&(e+i-1^e)?t[e/32|0]<<32-r^t[e/32+1|0]>>>r:t[e/32|0]>>>r)&(1<<i)-1},concat:function(t,e){if(0===t.length||0===e.length)return t.concat(e);var i=t[t.length-1],r=bauth.sjcl.bitArray.getPartial(i);return 32===r?t.concat(e):bauth.sjcl.bitArray._shiftRight(e,r,0|i,t.slice(0,t.length-1))},bitLength:function(t){var e,i=t.length;return 0===i?0:(e=t[i-1],32*(i-1)+bauth.sjcl.bitArray.getPartial(e))},clamp:function(t,e){if(32*t.length<e)return t;var i=(t=t.slice(0,Math.ceil(e/32))).length;return e&=31,i>0&&e&&(t[i-1]=bauth.sjcl.bitArray.partial(e,t[i-1]&2147483648>>e-1,1)),t},partial:function(t,e,i){return 32===t?e:(i?0|e:e<<32-t)+1099511627776*t},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(t,e){if(bauth.sjcl.bitArray.bitLength(t)!==bauth.sjcl.bitArray.bitLength(e))return!1;var i,r=0;for(i=0;i<t.length;i++)r|=t[i]^e[i];return 0===r},_shiftRight:function(t,e,i,r){var s,a,h;for(void 0===r&&(r=[]);e>=32;e-=32)r.push(i),i=0;if(0===e)return r.concat(t);for(s=0;s<t.length;s++)r.push(i|t[s]>>>e),i=t[s]<<32-e;return a=t.length?t[t.length-1]:0,h=bauth.sjcl.bitArray.getPartial(a),r.push(bauth.sjcl.bitArray.partial(e+h&31,e+h>32?i:r.pop(),1)),r},_xor4:function(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]},byteswapM:function(t){var e,i;for(e=0;e<t.length;++e)i=t[e],t[e]=i>>>24|i>>>8&65280|(65280&i)<<8|i<<24;return t}},bauth.sjcl.misc.hmac=function(t,e){this._hash=e=e||bauth.sjcl.hash.sha256;var i,r=[[],[]],s=e.prototype.blockSize/32;for(this._baseHash=[new e,new e],t.length>s&&(t=e.hash(t)),i=0;i<s;i++)r[0][i]=909522486^t[i],r[1][i]=1549556828^t[i];this._baseHash[0].update(r[0]),this._baseHash[1].update(r[1]),this._resultHash=new e(this._baseHash[0])},bauth.sjcl.misc.hmac.prototype.encrypt=bauth.sjcl.misc.hmac.prototype.mac=function(t){if(this._updated)throw new bauth.sjcl.exception.invalid("encrypt on already updated hmac called!");return this.update(t),this.digest(t)},bauth.sjcl.misc.hmac.prototype.reset=function(){this._resultHash=new this._hash(this._baseHash[0]),this._updated=!1},bauth.sjcl.misc.hmac.prototype.update=function(t){this._updated=!0,this._resultHash.update(t)},bauth.sjcl.misc.hmac.prototype.digest=function(){var t=this._resultHash.finalize(),e=new this._hash(this._baseHash[1]).update(t).finalize();return this.reset(),e},bauth.sjcl.hash.sha256=function(t){this._key[0]||this._precompute(),t?(this._h=t._h.slice(0),this._buffer=t._buffer.slice(0),this._length=t._length):this.reset()},bauth.sjcl.hash.sha256.hash=function(t){return(new bauth.sjcl.hash.sha256).update(t).finalize()},bauth.sjcl.hash.sha256.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(t){"string"==typeof t&&(t=bauth.sjcl.codec.utf8String.toBits(t));var e,i=this._buffer=bauth.sjcl.bitArray.concat(this._buffer,t),r=this._length,s=this._length=r+bauth.sjcl.bitArray.bitLength(t);if(s>9007199254740991)throw new bauth.sjcl.exception.invalid("Cannot hash more than 2^53 - 1 bits");if("undefined"!=typeof Uint32Array){var a=new Uint32Array(i),h=0;for(e=512+r-(512+r&511);e<=s;e+=512)this._block(a.subarray(16*h,16*(h+1))),h+=1;i.splice(0,16*h)}else for(e=512+r-(512+r&511);e<=s;e+=512)this._block(i.splice(0,16));return this},finalize:function(){var t,e=this._buffer,i=this._h;for(t=(e=bauth.sjcl.bitArray.concat(e,[bauth.sjcl.bitArray.partial(1,1)])).length+2;15&t;t++)e.push(0);for(e.push(Math.floor(this._length/4294967296)),e.push(0|this._length);e.length;)this._block(e.splice(0,16));return this.reset(),i},_init:[],_key:[],_precompute:function(){var t,e,i=0,r=2;function s(t){return 4294967296*(t-Math.floor(t))|0}for(;i<64;r++){for(e=!0,t=2;t*t<=r;t++)if(r%t==0){e=!1;break}e&&(i<8&&(this._init[i]=s(Math.pow(r,.5))),this._key[i]=s(Math.pow(r,1/3)),i++)}},_block:function(t){var e,i,r,s,a=this._h,h=this._key,n=a[0],c=a[1],u=a[2],o=a[3],l=a[4],b=a[5],f=a[6],p=a[7];for(e=0;e<64;e++)e<16?i=t[e]:(r=t[e+1&15],s=t[e+14&15],i=t[15&e]=(r>>>7^r>>>18^r>>>3^r<<25^r<<14)+(s>>>17^s>>>19^s>>>10^s<<15^s<<13)+t[15&e]+t[e+9&15]|0),i=i+p+(l>>>6^l>>>11^l>>>25^l<<26^l<<21^l<<7)+(f^l&(b^f))+h[e],p=f,f=b,b=l,l=o+i|0,o=u,u=c,n=i+((c=n)&u^o&(c^u))+(c>>>2^c>>>13^c>>>22^c<<30^c<<19^c<<10)|0;a[0]=a[0]+n|0,a[1]=a[1]+c|0,a[2]=a[2]+u|0,a[3]=a[3]+o|0,a[4]=a[4]+l|0,a[5]=a[5]+b|0,a[6]=a[6]+f|0,a[7]=a[7]+p|0}},bauth.sjcl.cipher.aes=function(t){this._tables[0][0][0]||this._precompute();var e,i,r,s,a,h=this._tables[0][4],n=this._tables[1],c=t.length,u=1;if(4!==c&&6!==c&&8!==c)throw new bauth.sjcl.exception.invalid("invalid aes key size");for(this._key=[s=t.slice(0),a=[]],e=c;e<4*c+28;e++)r=s[e-1],(e%c==0||8===c&&e%c==4)&&(r=h[r>>>24]<<24^h[r>>16&255]<<16^h[r>>8&255]<<8^h[255&r],e%c==0&&(r=r<<8^r>>>24^u<<24,u=u<<1^283*(u>>7))),s[e]=s[e-c]^r;for(i=0;e;i++,e--)r=s[3&i?e:e-4],a[i]=e<=4||i<4?r:n[0][h[r>>>24]]^n[1][h[r>>16&255]]^n[2][h[r>>8&255]]^n[3][h[255&r]]},bauth.sjcl.cipher.aes.prototype={encrypt:function(t){return this._crypt(t,0)},decrypt:function(t){return this._crypt(t,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var t,e,i,r,s,a,h,n,c=this._tables[0],u=this._tables[1],o=c[4],l=u[4],b=[],f=[];for(t=0;t<256;t++)f[(b[t]=t<<1^283*(t>>7))^t]=t;for(e=i=0;!o[e];e^=r||1,i=f[i]||1)for(a=(a=i^i<<1^i<<2^i<<3^i<<4)>>8^255&a^99,o[e]=a,l[a]=e,n=16843009*b[s=b[r=b[e]]]^65537*s^257*r^16843008*e,h=257*b[a]^16843008*a,t=0;t<4;t++)c[t][e]=h=h<<24^h>>>8,u[t][a]=n=n<<24^n>>>8;for(t=0;t<5;t++)c[t]=c[t].slice(0),u[t]=u[t].slice(0)},_crypt:function(t,e){if(4!==t.length)throw new bauth.sjcl.exception.invalid("invalid aes block size");var i,r,s,a,h=this._key[e],n=t[0]^h[0],c=t[e?3:1]^h[1],u=t[2]^h[2],o=t[e?1:3]^h[3],l=h.length/4-2,b=4,f=[0,0,0,0],p=this._tables[e],g=p[0],_=p[1],d=p[2],y=p[3],j=p[4];for(a=0;a<l;a++)i=g[n>>>24]^_[c>>16&255]^d[u>>8&255]^y[255&o]^h[b],r=g[c>>>24]^_[u>>16&255]^d[o>>8&255]^y[255&n]^h[b+1],s=g[u>>>24]^_[o>>16&255]^d[n>>8&255]^y[255&c]^h[b+2],o=g[o>>>24]^_[n>>16&255]^d[c>>8&255]^y[255&u]^h[b+3],b+=4,n=i,c=r,u=s;for(a=0;a<4;a++)f[e?3&-a:a]=j[n>>>24]<<24^j[c>>16&255]<<16^j[u>>8&255]<<8^j[255&o]^h[b++],i=n,n=c,c=u,u=o,o=i;return f}},bauth.sjcl.mode.cbc={name:"cbc",encrypt:function(t,e,i,r){if(r&&r.length)throw new bauth.sjcl.exception.invalid("cbc can't authenticate data");if(128!==bauth.sjcl.bitArray.bitLength(i))throw new bauth.sjcl.exception.invalid("cbc iv must be 128 bits");var s,a=bauth.sjcl.bitArray,h=a._xor4,n=a.bitLength(e),c=0,u=[];if(7&n)throw new bauth.sjcl.exception.invalid("pkcs#5 padding only works for multiples of a byte");for(s=0;c+128<=n;s+=4,c+=128)i=t.encrypt(h(i,e.slice(s,s+4))),u.splice(s,0,i[0],i[1],i[2],i[3]);return n=16843009*(16-(n>>3&15)),i=t.encrypt(h(i,a.concat(e,[n,n,n,n]).slice(s,s+4))),u.splice(s,0,i[0],i[1],i[2],i[3]),u},decrypt:function(t,e,i,r){if(r&&r.length)throw new bauth.sjcl.exception.invalid("cbc can't authenticate data");if(128!==bauth.sjcl.bitArray.bitLength(i))throw new bauth.sjcl.exception.invalid("cbc iv must be 128 bits");if(127&bauth.sjcl.bitArray.bitLength(e)||!e.length)throw new bauth.sjcl.exception.corrupt("cbc ciphertext must be a positive multiple of the block size");var s,a,h,n=bauth.sjcl.bitArray,c=n._xor4,u=[];for(r=r||[],s=0;s<e.length;s+=4)a=e.slice(s,s+4),h=c(i,t.decrypt(a)),u.splice(s,0,h[0],h[1],h[2],h[3]),i=a;if(0===(a=255&u[s-1])||a>16)throw new bauth.sjcl.exception.corrupt("pkcs#5 padding corrupt");if(h=16843009*a,!n.equal(n.bitSlice([h,h,h,h],0,8*a),n.bitSlice(u,32*u.length-8*a,32*u.length)))throw new bauth.sjcl.exception.corrupt("pkcs#5 padding corrupt");return n.bitSlice(u,0,32*u.length-8*a)}};