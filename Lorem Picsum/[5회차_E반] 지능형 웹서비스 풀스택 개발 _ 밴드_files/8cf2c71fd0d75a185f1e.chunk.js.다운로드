(window.webpackJsonp=window.webpackJsonp||[]).push([[177],{1751:function(t,e,n){var i;void 0===(i=function(t){var e,i=n(0),o=n(2),s=n(4),m=n(52),l=n(623),c=n(1094),a=n(508),h=n(159),r=n(1005),_=n(154),C=n(505),d=n(26),u=n(560),p=n(491),M=n(487),f=n(13),O=s.View.extend({className:"sReplyList",template:i.template('<h1 class="gSrOnly">'+IM("discover.post.comment.title")+'</h1><div class="_replyListRegion"></div>'),attributes:{"data-viewname":"DReplyListView","data-type":"comment"},behaviors:[M,h],ui:{replyListRegion:"._replyListRegion"},regions:{replyListRegion:{el:"@ui.replyListRegion",replaceElement:!0}},onMessages:(e={},e[h.MSG.COMMENT_GO_FIRST_COMMENT]=function(){this._fetchFirstCommentList()},e[h.MSG.COMMENT_PREVIOUS_MORE]=function(){this._fetchPreviousAndNextAllCommentList()},e[h.MSG.COMMENT_NEXT_MORE]=function(){this._fetchNextCommentList()},e[h.MSG.COMMENT_DELETE_COMMENT]=function(t){this._deleteComment(t)},e[h.MSG.COMMENT_SUBMIT_MODIFICATION]=function(t){this._modifyComment(t)},e),passMessages:function(){var t={};return t[h.MSG.COMMENT_GO_FIRST_COMMENT]=h.MSG.PROPAGATION_STOP,t[h.MSG.COMMENT_PREVIOUS_MORE]=h.MSG.PROPAGATION_STOP,t[h.MSG.COMMENT_NEXT_MORE]=h.MSG.PROPAGATION_STOP,t[h.MSG.COMMENT_DELETE_COMMENT]=h.MSG.PROPAGATION_STOP,t[h.MSG.COMMENT_SUBMIT_MODIFICATION]=h.MSG.PROPAGATION_STOP,t[h.MSG.COMMENT_HIDE_SELF_REPLY_INPUT]=h.MSG.PROPAGATION_STOP,t}(),initialize:function(t){this._bandNo=t.bandNo,this._ownerContentKey=t.ownerContentKey,this._contentKeyButCommentId=t.contentKeyButCommentId,this._initCommentReplyId=t.initCommentReplyId,this._openReplyInput=t.openReplyInput,this._isCommentingPermitted=t.isCommentingPermitted,this._commentCollection=this._createCommentCollection(),this._muteIgnoredAuthorUserNo=t.muteIgnoredAuthorUserNo,this._isHiddenFilterIgnored=t.isHiddenFilterIgnored,this._showEmotionArea=t.showEmotionArea,this._mentionOption=t.mentionOption},onAttach:function(){_.wrapActivePromise(p.getCachedBandData(this._bandNo),this).then(i.bind((function(t){this._bandData=t,this._renderList()}),this))},hasModificationComment:function(){return this._commentCollectionView&&this._commentCollectionView.isModificationMode()},hideEveryReplyInputArea:function(){this.isDestroyed()||null==this._commentCollectionView||this._commentCollectionView.hideEveryReplyInputArea()},cancelChildrenModificationMode:function(){this._commentCollectionView&&this._commentCollectionView.cancelDescendantModificationMode()},fetchAroundComment:function(){return this._commentCollection.fetchAroundCommentList(this._initCommentReplyId).then(i.bind((function(t){this._commentCollectionView.setOldestCommentShow(!1),this._populateFetchedCollectionWithReset(t)}),this))},scrollToComment:function(t){this._commentCollectionView.scrollToComment(t)},_renderList:function(){this._commentCollectionView=c.buildDCommentCollectionView({maxMessageLength:a.MAX_LENGTH,overMaxLengthAlertMessage:IM("comment.over_max_message",{count:a.MAX_LENGTH}),isCommentingPermitted:this._isCommentingPermitted&&f.isLogedIn(),replySupport:this._bandData.canWriteReply(),isReplyButTopMost:!0,canUsePaging:this._bandData.canMoveToMoreComment(),canExpressEmotion:this._bandData.canExpressEmotionOnComment(),canOpenMediaViewer:this._bandData.canOpenMediaViewerOnComment(),canDownloadFile:this._bandData.canDownloadFileOnComment(),canOpenSnippetUrl:this._bandData.canOpenSnippetUrlOnComment(),mentionOption:this._mentionOption}),this.showChildView("replyListRegion",this._commentCollectionView),_.wrapActivePromise(this._fetchInitCommentList(),this).then(i.bind((function(){this._openReplyInput&&this._commentCollectionView.openReplyInputByCommentId(this._initCommentReplyId),this._initCommentReplyId&&this._commentCollectionView.scrollToComment(this._initCommentReplyId)}),this))},_fetchInitCommentList:function(){return null!=this._initCommentReplyId&&this._bandData.canMoveToMoreComment()?this.fetchAroundComment():this._fetchLastCommentList()},_fetchLastCommentList:function(){return this._commentCollection.fetchLastCommentList().then(i.bind((function(t){this._commentCollectionView.setOldestCommentShow(!1),this._populateFetchedCollectionWithReset(t)}),this))},_populateFetchedCollection:function(t,e){if(!this._commentCollectionView.isDestroyed()){this._populatePagingParams(t,e);var n=this._convertCommentCollectionToViewArray(t);this._commentCollectionView.populateFetchedCollection(n,t.getTotalCount(),!1,null!=this._previousParams,null!=this._nextParams),this.spawn(h.MSG.COMMENTLIST_CHANGE_COLLECTION)}},_populatePagingParams:function(t,e){var n=t.getPagingData();e.previous&&(this._previousParams=n.previous_params,this._firstParams=n.first_params),e.next&&(this._nextParams=n.next_params,this._updateParams=n.update_param)},_populateFetchedCollectionWithReset:function(t){if(!this._commentCollectionView.isDestroyed()){this._populatePagingParams(t,{previous:!0,next:!0});var e=this._convertCommentCollectionToViewArray(t);this._commentCollectionView.populateFetchedCollection(e,t.getTotalCount(),!0,null!=this._previousParams,null!=this._nextParams),this.spawn(h.MSG.COMMENTLIST_CHANGE_COLLECTION)}},_populateFetchedCollectionAndChangeSortOrder:function(t,e,n){this.isDestroyed()||this._commentCollectionView.isDestroyed()||(this._commentCollectionView.isOldestCommentShow()!=e?(this._commentCollectionView.setOldestCommentShow(e),this._populateFetchedCollectionWithReset(t)):this._populateFetchedCollection(t,n))},_convertCommentCollectionToViewArray:function(t){var e=t.getContentKeyButCommentId();return t.map(i.bind((function(t){return r.buildByDetailDComment(t,this._bandData,e,!0,this._muteIgnoredAuthorUserNo,this._isHiddenFilterIgnored,this._showEmotionArea)}),this))},_deleteComment:function(t){if(confirm(IM("web.commentdetail.comment.confirm.delete_comment"))){var e=t.contentKey,n=e.getCommentId();_.wrapActivePromise(C.deleteComment(this._bandNo,e.toApiParams(!0)),this).then(i.bind((function(){this._commentCollectionView.deleteCommentOnView(n,null!=this._previousParams,null!=this._nextParams),this.spawn(h.MSG.COMMENTLIST_CHANGE_COLLECTION),this.spawn(h.MSG.COMMENT_REPLY_DELETED),d.getCommentChannel().trigger(d.EVENT.BAND_FILE_UPDATED),d.getCommentChannel().trigger(d.EVENT.COMMENT_DELETED,e)}),this))}},_fetchFirstCommentList:function(){return this._commentCollection.fetchCommentList(this._firstParams).then(i.bind((function(t){this._populateFetchedCollectionAndChangeSortOrder(t,!0,{previous:!0,next:!0})}),this))},_fetchPreviousAndNextAllCommentList:function(){o.when(this._fetchPreviousCommentList(),this._fetchNextAllCommentList())},_fetchPreviousCommentList:function(){return this._commentCollection.fetchCommentList(this._previousParams).then(i.bind((function(t){this._populateFetchedCollection(t,{previous:!0})}),this))},_fetchNextAllCommentList:function(){return this._commentCollectionView.isEmptyCollection()?this._fetchLastCommentList():this._nextParams?void 0:this._commentCollection.fetchCommentList(this._updateParams).then(i.bind((function(t){return this._populateFetchedCollection(t,{next:!0})}),this))},_fetchNextCommentList:function(){return this._commentCollection.fetchCommentList(this._nextParams).then(i.bind((function(t){return this._populateFetchedCollection(t,{next:!0})}),this))},_modifyComment:function(t){u.modifyComment(this._bandNo,t,this).then(i.bind((function(e){var n={};n.comments=m.camelizeKeys(e.comment),n.totalCount=t.totalCount,d.getCommentChannel().trigger(d.EVENT.BAND_FILE_UPDATED);var i=this._createCommentCollection();this._populateFetchedCollection(i.populateDetailCommentData(n),{})}),this),(function(){t.modificationView.releaseModificationProgress()})).always(i.bind((function(){this.spawn(h.MSG.COMMENTLIST_SHOW_INPUT)}),this))},_createCommentCollection:function(){return l.buildDetailCommentCollection({bandNo:this._bandNo,ownerContentKey:this._ownerContentKey,contentKeyButCommentId:this._contentKeyButCommentId})}});return O.buildDReplyListView=function(t){return new O(t)},O}.call(e,n,e,t))||(t.exports=i)}}]);